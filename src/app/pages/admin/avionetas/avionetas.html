<div class="avionetas-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1 class="page-title">
        <svg class="title-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <path d="M50 20 L40 35 L20 35 L25 45 L15 45 L20 50 L15 55 L25 55 L20 65 L40 65 L50 80 L60 65 L80 65 L75 55 L85 55 L80 50 L85 45 L75 45 L80 35 L60 35 Z" fill="currentColor"/>
        </svg>
        Gestión de Avionetas
      </h1>
      <p class="page-description">Administra la flota de avionetas y su mantenimiento</p>
    </div>
    <button class="btn-primary" (click)="openModal()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      Nueva Avioneta
    </button>
  </div>

  <!-- Filtros y búsqueda -->
  <div class="filters-section">
    <div class="search-box">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
      <input
        type="text"
        placeholder="Buscar por código o modelo..."
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        class="search-input"
      />
    </div>

    <div class="filter-group">
      <select [(ngModel)]="filterEstado" (change)="onFilterChange()" class="filter-select">
        <option value="">Todos los estados</option>
        <option value="Activo">Activas</option>
        <option value="Mantenimiento">En Mantenimiento</option>
      </select>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando avionetas...</p>
  </div>

  <!-- Grid de avionetas -->
  <div *ngIf="!loading" class="avionetas-grid">
    <div *ngFor="let avioneta of avionetas" class="avioneta-card">
      <div class="card-header" [ngClass]="avioneta.estado === 'Activo' ? 'header-active' : 'header-maintenance'">
        <div class="plane-icon">
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path d="M50 20 L40 35 L20 35 L25 45 L15 45 L20 50 L15 55 L25 55 L20 65 L40 65 L50 80 L60 65 L80 65 L75 55 L85 55 L80 50 L85 45 L75 45 L80 35 L60 35 Z" fill="white"/>
          </svg>
        </div>
        <span class="status-badge-card" [ngClass]="avioneta.estado === 'Activo' ? 'status-active' : 'status-maintenance'">
          {{ avioneta.estado }}
        </span>
      </div>

      <div class="card-body">
        <h3 class="card-title">{{ avioneta.codigo }}</h3>
        <p class="card-modelo">{{ avioneta.modelo }}</p>

        <div class="card-stats">
          <div class="stat-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            <div class="stat-info">
              <span class="stat-label">Horas de Vuelo</span>
              <span class="stat-value">{{ avioneta.horas_vuelo }} hrs</span>
            </div>
          </div>
        </div>

        <div *ngIf="avioneta.observaciones" class="card-observations">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
          <p>{{ avioneta.observaciones }}</p>
        </div>
      </div>

      <div class="card-footer">
        <button class="btn-card btn-edit" (click)="openModal(avioneta)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          Editar
        </button>
        <button 
          class="btn-card"
          [ngClass]="avioneta.estado === 'Activo' ? 'btn-maintenance' : 'btn-activate'"
          (click)="toggleEstado(avioneta)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path *ngIf="avioneta.estado === 'Activo'" d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            <polyline *ngIf="avioneta.estado !== 'Activo'" points="20 6 9 17 4 12"/>
          </svg>
          {{ avioneta.estado === 'Activo' ? 'Mantenimiento' : 'Activar' }}
        </button>
        <button class="btn-card btn-delete" (click)="deleteAvioneta(avioneta)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
          Eliminar
        </button>
      </div>
    </div>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && avionetas.length === 0" class="empty-state">
    <svg class="empty-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <path d="M50 20 L40 35 L20 35 L25 45 L15 45 L20 50 L15 55 L25 55 L20 65 L40 65 L50 80 L60 65 L80 65 L75 55 L85 55 L80 50 L85 45 L75 45 L80 35 L60 35 Z" fill="#cbd5e1"/>
    </svg>
    <h3>No se encontraron avionetas</h3>
    <p>Intenta ajustar los filtros o registra una nueva avioneta</p>
  </div>
</div>

<!-- Modal de Crear/Editar Avioneta -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Editar Avioneta' : 'Nueva Avioneta' }}</h2>
      <button class="btn-close" (click)="closeModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <form [formGroup]="avionetaForm" (ngSubmit)="onSubmit()" class="modal-form">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Código *</label>
          <input
            type="text"
            formControlName="codigo"
            class="form-input"
            placeholder="Ej: N-172SP"
            [class.input-error]="isFieldInvalid('codigo')"
          />
          <span class="error-text" *ngIf="isFieldInvalid('codigo')">
            El código es requerido
          </span>
        </div>

        <div class="form-group">
          <label class="form-label">Modelo *</label>
          <input
            type="text"
            formControlName="modelo"
            class="form-input"
            placeholder="Ej: Cessna 172 Skyhawk"
            [class.input-error]="isFieldInvalid('modelo')"
          />
          <span class="error-text" *ngIf="isFieldInvalid('modelo')">
            El modelo es requerido
          </span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Horas de Vuelo</label>
          <input
            type="number"
            step="0.01"
            formControlName="horas_vuelo"
            class="form-input"
            placeholder="0.00"
            [class.input-error]="isFieldInvalid('horas_vuelo')"
          />
          <span class="error-text" *ngIf="isFieldInvalid('horas_vuelo')">
            Debe ser un número válido mayor o igual a 0
          </span>
        </div>

        <div class="form-group">
          <label class="form-label">Estado *</label>
          <select
            formControlName="estado"
            class="form-input"
            [class.input-error]="isFieldInvalid('estado')"
          >
            <option value="">Seleccione un estado</option>
            <option value="Activo">Activo</option>
            <option value="Mantenimiento">Mantenimiento</option>
          </select>
          <span class="error-text" *ngIf="isFieldInvalid('estado')">
            El estado es requerido
          </span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Observaciones</label>
        <textarea
          formControlName="observaciones"
          class="form-input"
          rows="4"
          placeholder="Notas sobre la avioneta, historial de mantenimiento, etc..."
        ></textarea>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="closeModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-primary" [disabled]="submitting">
          <span *ngIf="!submitting">{{ isEditMode ? 'Actualizar' : 'Registrar' }}</span>
          <span *ngIf="submitting" class="btn-loading">
            <span class="spinner-small"></span>
            Guardando...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>